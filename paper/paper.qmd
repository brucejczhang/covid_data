---
title: "Number of COVID-19 Cases in Canada in 2022 By Region, Age, and Sex"
subtitle: "Predicting the Factors that Influence the Probability of High Risk of COVID-19"
author: 
  - Bruce Zhang
thanks: "Code and data are available at: [https://github.com/brucejczhang/covid_data](https://github.com/brucejczhang/covid_data)."
date: today
date-format: long
abstract: "This paper examines the demographic and regional factors influencing high-risk classifications for COVID-19 in Canada using logistic regression models, with predictors including age, sex, and region. The analysis reveals that rural regions, males, and specific age intervals exhibit higher probabilities of being classified as high risk, emphasizing disparities in healthcare access and outcomes. These findings highlight the importance of targeted public health interventions, such as resource allocation and vaccination prioritization, to mitigate these risks and can potentially guide interventions for future pandemics. By identifying key predictors and their implications, this study provides a scalable framework for improving pandemic preparedness and understanding health disparities."
format: pdf
toc: true
toc-depth: 3
include-before:
  - \newpage
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(ggplot2)
library(dplyr)
library(here)
library(arrow)

# Load the dataset
analysis_data <- read_parquet(here("data", "02-analysis_data", "analysis_data.parquet"))
```
\newpage
# Introduction

The COVID-19 pandemic is something that is difficult to forget. Although it is now in the past, the effects that it had on society and how we function as individuals is still noticeable. At the same time, the statistical information that sprouted from the pandemic has a high value for analysis. This is not only to better understand the pandemic and how it affected populations but also to form a strong idea of its patterns to suggest tactics for dealing with pandemics shall something similar happen in the future.

Studies have been done in recent years in attempts to utilize the data that was gathered during COVID times to better advise future preventions and treatment for pandemic situations. Many studies look into the relationship between demographic information of populations and their likelihood of getting diagnosed or fatality. One study found that communities on hillsides and other locations with enhanced ventilation and oxygen had reduced numbers of COVID cases [@cite-covid_demographics]. Other studies have found relationships between exercise and cardiovascular function and the likelihood of getting COVID [@cite-cardio_and_covid]. Although many relationships have been examined, there has been a lack of studies focusing on a broad set of demographic traits such as age and sex. There has also not been cross comparisons of region and demographic aspects. Another area where research is needed is for country-specific analysis, particularly Canada. 

This analysis looks at COVID-19 data from 2022 in Canada and analyzes how the different population and individual-level demographic variables, such as age, sex, and region of life, influenced the risk of fatality from COVID-19. The analysis focuses on isolating these demographic factors and examining their individual effects. The paper uses the demographic data gathered from 2022 to predict the characteristics of populations and individuals that may be at higher risk of fatality once they have been diagnosed with COVID. 

One importance of this information to be present is mainly for Canada-specific situations and patterns that may not be seen in a global scale analysis. The geographic location, temperature, population distribution, ethnic diversity, and other features of Canada is incredibly unique. The patterns present in other countries cannot be generalized to a smaller scale. From a public health standpoint, global health data is key in understanding overarching trends of epidemiology, but country specific (sometimes community specific) analyses are key for creating predictions based on a suitably-sized dataset [@frumkin]. 

Another key importance of this analysis is its focus on basic demographic factors rather than specific health factors. It is often that a health issue, COVID-19, is examined through the lens of other health factors [@swanson_verdugo]. For example, how does the presence of another long-term disease influence the risk of COVID-19. Looking at surface level demographic information can provide information that is useful to a broader audience. Specific diseases may not be possessed by everyone, but demographic information is. This information is also known by individuals, which will help them identify the category they fall into and examine their risk of COVID-19 based on their demographic information. 

The estimand of this analysis is the correlation between demographic information, including age, sex, and region, and the predicted probability of high risk for COVID-19. The analysis focuses on the outcome variable of predicted probability of high risk, which is a function of number of cases and number of deaths per datapoint and is further defined in @sec-model. The model predicts the probability of high risk as a result of a series of predictor variables including region, sex, and age of the reported data. 

The analysis showed that there are disparities in the risk of severe COVID-19 outcomes across demographic and regional categories. Logistic regression models demonstrated that individuals in rural regions consistently faced higher probabilities of being classified as high risk, with males and specific age intervals further amplifying this vulnerability. These findings were supported by consistent trends in summary statistics and model visualizations, which showed the interplay between predictors such as age, region, and sex in influencing COVID-19 outcomes.

This analysis may have broader implications for preventative measures for flues, other diseases, and pandemics in the future. Understanding the reasons behind COVID-19 severity can craft equitable and effective public health responses. By identifying which demographic and regional groups face the greatest risks, the results of the analysis can guide resource distribution, including vaccination programs and medical support, to areas where they are most needed. These are applicable not only to COVID-19 but also to future public health challenges.

The remainder of this paper is structured as follows. The data section (@sec-data) highlights the characteristics of the dataset. The section summarizes the data through a series of summary statistics and represents the data in a visual way where specific trends and patterns can be observed. The model section (@sec-model) creates a logistic regression model predicting the probability of high risk depending on the region, sex, and age of the data point. This section presents the mathematical basis of the model and justifies the selection for the logistic regression model over others. The results section (@sec-results) includes model figures that display the predicted probabilities of high risk for the predictor variables respectively. The discussion section (@sec-discussion) goes over how the results from the modeling can be interpreted in the context of the real world and how these findings can be utilized to advise public health measures. It also discusses limitations of the analysis and future directions.


# Data {#sec-data}

## Overview

I use the statistical programming language R [@citeR] to analyze the data and to create graphs and models. Th packages that were used include tidyverse [@tidyverse], tidyr [@tidyr], dplyr [@dplyr], arrow [@arrow], DataExplorer [@dataexplorer], corrplot [@corrplot], caret [@caret], httr [@httr], here[@here], and pROC [@pROC]. My data [@covid_data] was obtained from COVerAGE-DB, which was housed in Open Science Framework. The data anlysis was conducted based on the guidance of @tellingstories.

## Measurement

The data collection process is conducted by hospitals and governmental institutions that get first-handed numbers of COVID-19 patient information. Individuals who have symptoms and choose to visit a hospital will get tested, this number will be reported as the number of tests. Those that test positive for COVID-19 in the hospitals will be reported as the number of cases. Those who report deaths to the government level and indicate that the cause is due to COVID-19 will be recorded as the number of deaths due to COVID. 

The data that was collected through hopistals and government institutions was gathered by COVerAGE-DB, a database that focuses on COVID related data. COVerAGE-DB consolidates this information into the dataset that was used in the analysis. COVerAGE-DB often gathers data relating to COVID such as the number of cases, deaths, tests, and vaccinations through governmental institutes such as health ministries and statistical offices. This data is then organized by other variables such as sex, region, country, and age and presented to the general public. 

The data collected through hospitals or governmental institutes only reflect individuals who have visited hospitals for their symptoms and tested positive for COVID-19 there. This poses a key limitation of potential inaccuracy of numbers due to the large portion of individuals who self-test PCR, visit PCR testing stations, or don't get tested and stay home despite having symptoms. These situations were common given the situation in Canada in 2022, where individuals were encouraged to stay home if symptoms were experienced rather than visit hospitals to report their results. 

The dataset reflects a transformation of real-world phenomena—COVID-19 cases, deaths, and testing rates—into structured entries that can be analyzed. It also reflects the data collection challenges and biases of the real world, potentially understating values. Each entry in the dataset represents aggregated information collected from health departments, governmental organizations, and research institutions worldwide. These organizations report COVID-19 statistics at varying levels of granularity, such as daily case counts or weekly summaries, which are then standardized and compiled into the dataset. This effort of data collection allows the real-world challenges, as accurately as possible despite obvious limitations, of facing COVID-19 to be transformed into quantitative measures that can be analyzed and modeled. 

## Data Cleaning

The original dataset contained data from five different countries including. For the purpose to focus on data in Canada for this analysis, the datapoints for other countries were removed. This was the initial step in data cleaning. 

Further data cleaning was undertaken to ensure the quality and integrity of the dataset. First, missing values were identified and handled by checking each column. Any missing values were flagged and removed. Second, the dataset was checked for duplicates to avoid redundant entries, ensuring each row represented a unique combination of key columns such as Country, Region, Date, and Age. Additionally, logical consistency checks were conducted to identify and correct any issues, such as negative values in Cases, Deaths, or Tests, or where Deaths exceeded Cases, which are not plausible in real-world data. Inconsistent or invalid values in categorical variables, such as Region or Sex, were also detected and addressed to match predefined valid categories. Finally, summary statistics and visualizations were generated to examine the distribution of numerical variables and detect any anomalies that could indicate data entry errors. 

## Outcome Variables and Predictor Variables

The cleaned dataset contains variables including the country, region, date, sex, and age where the number of cases, deaths, and tests were reported. @sec-appendixraw shows a sample of the dataset, presenting the first six rows of the analysis data. The outcome variables highlighted include the total number of cases and the total number of deaths. 

```{r}
#| label: fig-summary
#| fig-cap: Summary Statistics of COVID-19 Cases in Canada. The table shows the averages and totals of key numerical variables including age, cases, tests, and deaths. It also calculates the case fatality rate (CFR) as number of deaths divided by number of cases. 
#| echo: false
#| warning: false
#| message: false

# Load necessary libraries
library(dplyr)
library(knitr)

# Create the summary statistics table
summary_table <- analysis_data %>%
  filter(Region %in% c("Urban", "Rural"), Sex %in% c("f", "m")) %>%
  group_by(Region, Sex) %>%
  summarise(
    Mean_Age = round(mean(Age, na.rm = TRUE), 2), # Rounded Mean Age
    Total_Cases = sum(Cases, na.rm = TRUE),
    Total_Deaths = sum(Deaths, na.rm = TRUE),
    Average_Cases = round(mean(Cases, na.rm = TRUE), 2), # Rounded Average Cases
    Average_Deaths = round(mean(Deaths, na.rm = TRUE), 2), # Rounded Average Deaths
    CFR = round((Total_Deaths / Total_Cases) * 100, 2) # Rounded CFR (%)
  ) %>%
  ungroup()

# Render the table using kable
summary_table %>%
  kable(
    col.names = c("Region", "Sex", "Mean Age", "Total Cases", "Total Deaths", 
                  "Average Cases", "Average Deaths", "CFR (%)")
  )


```

@fig-summary further breaks down the data summarizing the mean number of cases and deaths by region and sex. This creates an all-rounded summary of the dataset and gives a preliminary idea on the differences in cases and deaths depending on the categories of sex and region. 

### Number of Cases and Number of Deaths

The total and average numbers of cases and deaths are key outcome variables that can be correlated with the categorical predictors. These number can demonstrate the differences in COVID-19 susceptibility and threat level based on the characteristics of the region and the individual. 

### Case Fatality Rate

The case fatality rate (CFR) is an additional aspect of the summary that was calculated to standardize the deaths and cases by category. This can be used as a processed outcome variable that can better represent the dataset and aid modeling later on. The total number of deaths and cases may lead to inaccurate representations of a region, sex, or age group due to the absolute number of individuals that fall within the category. The CFR value allows better comparison across categories. 


```{r}
#| echo: false
#| eval: true
#| label: fig-cases_over_time
#| fig-cap: Number of COVID-19 cases per month in 2022 in Canada. The red trend line highlights the pattern of COVID-19 cases by month in Canada throughout 2022. 
#| warning: false

# Load necessary libraries
library(dplyr)
library(ggplot2)
library(lubridate)
set.seed(21)

# Ensure Date is a proper Date object
analysis_data <- analysis_data %>%
  mutate(Date = as.Date(Date))

# Aggregate data by month and year
aggregated_data <- analysis_data %>%
  mutate(Month_Year = floor_date(Date, unit = "month")) %>% # Group by month
  group_by(Month_Year) %>%
  summarise(
    Total_Cases = sum(Cases, na.rm = TRUE) # Summing cases for each month
  ) %>%
  ungroup()

# Create the bar graph with trend line
ggplot(aggregated_data, aes(x = Month_Year, y = Total_Cases)) +
  geom_bar(stat = "identity", fill = "steelblue", alpha = 0.8) + # Bar plot
  geom_smooth(method = "loess", se = TRUE, color = "red", size = 1.2) + # Trend line
  labs(
    title = "",
    x = "Month-Year",
    y = "Total Cases"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1), # Rotate x-axis labels
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold")
  )

```

### Time

The time of year can also be correlated with the likelihood of getting COVID-19 independent of other predictor variables. As shown in @fig-cases_over_time, there is a weak pattern of increased total number of cases in the early summer months of May and June. The number of cases in winter and near winter months, specifically January and October, seem to be lower. 

```{r}
#| label: fig-cfr
#| fig-cap: Case Fatality Rate (CFR) by Age Group, Region, and Sex. Urban and rural regions are separated into two subfigures, each characterizing male and females by color and displaying differences by age intervals. 
#| echo: false
#| warning: false
#| message: false

# Load necessary libraries
library(ggplot2)
library(dplyr)
set.seed(21)

# Filter data to include only Urban and Rural regions and relevant sexes
filtered_data <- analysis_data %>%
  filter(Region %in% c("Urban", "Rural"), Sex %in% c("f", "m")) %>% # Filter for Urban, Rural, and f/m genders
  mutate(Age_Group = cut(Age, breaks = seq(0, 100, by = 10), include.lowest = TRUE)) # Create age intervals

# Aggregate data by Age_Group, Region, and Sex, and calculate CFR
aggregated_data <- filtered_data %>%
  group_by(Age_Group, Region, Sex) %>%
  summarise(
    Total_Deaths = sum(Deaths, na.rm = TRUE),  # Sum up deaths
    Total_Cases = sum(Cases, na.rm = TRUE),    # Sum up cases
    CFR = (Total_Deaths / Total_Cases) * 100   # Calculate CFR
  ) %>%
  ungroup()

# Create the bar graph for CFR by age group, region, and sex
ggplot(aggregated_data, aes(x = Age_Group, y = CFR, fill = Sex)) +
  geom_bar(stat = "identity", position = "dodge") + # Dodge bars to show sexes side by side
  facet_wrap(~Region, ncol = 1) + # Separate plots for Urban and Rural regions
  labs(
    title = "",
    x = "Age Group",
    y = "CFR (%)",
    fill = "Sex"
  ) +
  scale_fill_manual(
    values = c("m" = "steelblue", "f" = "pink") # Specify colors for "m" and "f"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1), # Rotate x-axis labels for readability
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold"),
    strip.text = element_text(size = 12, face = "bold") # Adjust facet labels
  )

```
### Age, Sex, and Region

Age, sex, and region are key predictor variables that are examined in this analysis. In @fig-cfr, these variables are organized relative to the CFR, which calculates a rate based on the number of cases and number of deaths and allows standardized comparisons across different predictor variables. 
@fig-cfr shows that the urban and rural regions have similar patterns in CFR across different age groups. The CFR for males tend to be higher more often than not compared to the CFR of females, indicating that males may have a higher likelihood of death after diagnosis of COVID in Canada. The pattern of CFR in relation to age seem to vary quite significantly between urban and rural regions and between male and females. For females, the highest CFR seems to be for individuals aged under 30 and for those around 70 to 80 regardless of region. Male CFR values peak at age interval 20 to 30 for urban regions and 30 to 40 for rural regions. 

@fig-cfr_by_region shows a more direct comparison of the CFR between urban and rural regions of Canada, combining different age groups and sexes. This figure shows that the CFR in rural regions is noticeably higher than that of urban. Although the difference is small, it is still a considerable size difference when considering the number of people that a small percentage can be responsible for, based on the summary statistics from @fig-summary. 

```{r}
#| echo: false
#| eval: true
#| label: fig-cfr_by_region
#| fig-cap: "Case Fatality Rate (CFR) by Region in 2022 in Canada. CFR percentage is shown to be slightly higher in urban areas than rural areas."
#| warning: false

# Load necessary libraries
library(ggplot2)
library(dplyr)
set.seed(21)

# Filter data for the selected 5 countries and group by region and country
selected_countries <- c("Afghanistan", "Brazil", "Canada", "Denmark", "Egypt")
region_cfr_summary <- analysis_data %>%
  filter(Country %in% selected_countries, Region %in% c("Urban", "Rural")) %>% # Filter for selected countries and regions
  group_by(Country, Region) %>%
  summarise(
    Total_Deaths = sum(Deaths, na.rm = TRUE),  # Summarize total deaths
    Total_Cases = sum(Cases, na.rm = TRUE),    # Summarize total cases
    CFR = (Total_Deaths / Total_Cases) * 100  # Calculate CFR
  ) %>%
  ungroup()

# Create the faceted bar graph for CFR by region
ggplot(region_cfr_summary, aes(x = Region, y = CFR, fill = Region)) +
  geom_bar(stat = "identity", alpha = 0.8, color = "black") + # Bar plot with CFR
  scale_fill_manual(values = c("Urban" = "lightgreen", "Rural" = "yellow")) + # Optional: Region-specific colors
  labs(
    title = "",
    x = "Region",
    y = "CFR (%)",
    fill = "Region"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(size = 12),
    axis.title = element_text(size = 14),
    strip.text = element_text(size = 14),
    panel.spacing = unit(1, "lines") # Increase spacing between facets
  )

```


# Model {#sec-model}

The primary goal of the model is to act as a tool for prediction for the level of high risk based on the characteristics of the specific datapoint. It can be used to identify how at risk a specific region, sex, or age group is for COVID-19 fatality. The mathematical definition of high risk is included in @sec-model_setup alongside a mathematical definition of CFR. Overall, the CFR is the number of deaths per cases while the high risk is when that level exceeds the median across the entire population. 

The model described here is a logistic regression model. This was selected based on the binary and categorical nature of many predictor and outcome variables. Justification of this choice is included in @sec-model_justification and @sec-model_validation, with more details included in the appendix (@sec-appendixc). 

## Model set-up {#sec-model_setup}

A logistic model has been selected as part of this analysis to examine the relationship between region, sex, age, and the number of cases and deaths of COVID-19. 

The logistic regression model predicts the probability of a region or individual being classified as "high risk" based on key predictors. In this case, "high risk" is defined as regions where the death rate (CFR) exceeds the median death rate across the dataset.

The CFR is calculated as: 
\begin{align}
\text{CFR} = \frac{\text{Deaths}}{\text{Cases} + 10^{-6}} \times 100
\end{align}

The box-and-whisker plot visualizes the distribution of predicted probabilities (\( p \)) across different age intervals. Each box represents the interquartile range (IQR) of predicted probabilities, with the line inside the box indicating the median predicted probability for that age interval. Whiskers extend to 1.5 times the IQR, and any points outside this range are considered outliers. This visualization highlights the variability of predicted probabilities within each age group.

The logistic regression model equation is:
\begin{align}
\text{logit}(p) = \ln\left(\frac{p}{1 - p}\right) = \beta_0 + \beta_1 \cdot \text{Tests} + \beta_2 \cdot \text{Age} + \beta_3 \cdot \text{Region} + \epsilon
\end{align}


where:
\begin{itemize}
    \item $p$: Predicted probability of being high risk ($p = \text{Predicted Probability}$).
    \item $\text{logit}(p)$: Log-odds of the high-risk classification.
    \item $\beta_0$: Intercept of the model.
    \item $\beta_1, \beta_2$: Coefficients for the predictors (e.g., number of tests, age interval).
    \item $\epsilon$: Error term.
\end{itemize}


This model explains how testing rates and age intervals affect the likelihood of a region or demographic being classified as high risk. The box-and-whisker plot shows the variability of predicted probabilities across age groups, helping to identify specific age intervals with consistently higher or lower risks.

We run the model in R [@citeR] using the 'pROC' [@pROC] and 'caret [@caret] packages to construct and test the model. 

## Model justification {#sec-model_justification}

For the analysis, a logistic regression model was chosen to predict the probability of a region or individual being classified as "high risk" based on key predictors such as age, sex, region, and the number of COVID-19 tests conducted. Logistic regression is particularly well-suited for this dataset because the outcome variable, high risk, is binary (e.g., classified as high risk or not). This makes logistic regression the most appropriate modeling technique as it directly estimates the probability of the binary outcome through the log-odds transformation. Compared to other models like linear regression, logistic regression avoids the issue of nonsensical predictions, such as probabilities below 0 or above 1, ensuring the interpretability of the results. Most importantly, logistic regression can handle both categorical and continuous predictors effectively. For this particular dataset, the key predictor variables are all categorical, even age is categorized by intervals. Therefore, it was extremely necessary for the model to be able to handl categorical data, which the logistic regression model is capable of. 

Another key advantage of the logistic regression model in this context is that it provides interpretable coefficients, which allow for an understanding of how specific predictors influence the odds of being high risk. This interpretability is very important for public health applications. Furthermore, logistic regression is computationally efficient, making it ideal for datasets with relatively straightforward structures like this one. Thus, the logistic regression model strikes an appropriate balance between accuracy, interpretability, and simplicity, making it the most suitable choice for this analysis.

The details on model selection can be found in the appendix in @sec-appendixb

## Assumptions and Limitations {#sec-model_assumptions}

The logistic regression model assumes that observations within the dataset are independent, meaning that each data point does not influence others. However, this assumption could be violated if individuals within the same region share similar environmental, healthcare, or socioeconomic factors that contribute to their risk classification. Additionally, the model assumes that the predictors, such as age, sex, and region, are not highly correlated. Significant multicollinearity between these variables could undermine the stability of the model coefficients and reduce interpretability. Finally, the classification of "high risk" as regions or individuals exceeding the median death rate simplifies a complex phenomenon. This threshold may fail to capture subtler variations in risk factors across different demographic and geographic contexts.

One key limitation of logistic regression is its inability to account for interactions between predictors without explicitly adding interaction terms. For instance, the combined effects of age and sex on risk may not be fully captured in this model. Additionally, the model assumes a predefined functional form, which limits its flexibility in identifying nonlinear relationships between predictors and outcomes. As a result, more complex patterns in the data may remain undetected, suggesting the need for alternative modeling approaches such as random forests or decision trees in future studies.

## Model Validation {#sec-model_validation}

For the model validation process of the selected logistic regression model, multiple validation techniques were used. Firstly, a ROC curve was constructed to visualize the trade-off between sensitivity and specificity. The ROC curve showed a high curve that deviated from the linear line representing random chance between sensitivity and specificity. The AUC value accompanying the ROC curve was above 0.8 for all three prediction models constructed for different variables. 

A confusion matrix was also constructed to assess classification accuracy, precision, and recall by comparing the predicted classes to the actual outcomes. Values of above 0.75 were yielded for the accuracy rating. Lastly, the odds ratios with confidence intervals provided information on the strength and direction of the predictors' effects. 

In general, these results demonstrated the suitability and strong effect that the logistic regression model has to predict probability of high risk based on the data. 

Details of the model validation are provided in the appendix (@sec-appendixc). 


# Results {#sec-results}

The results of this analysis are summarized in @fig-model_region, @fig-model_sex, and @fig-model_age to give an all-rounded picture of the predicted probability of high risk based on the different predictor variables. 

## Predicted Probability of High Risk by Region {#sec-results_region}

```{r}
#| label: fig-model_region
#| fig-cap: Predicted probability of high risk of COVID-19 by region (Urban vs. Rural). This is a density plot showing that the extremes of predicted probability of high risk are more frequent for both urban and rural regions. 
#| echo: false
#| warning: false
#| message: false
#| results: 'hide'

# Load necessary libraries
library(dplyr)
library(ggplot2)
set.seed(21)

# Step 1: Filter for Urban and Rural Regions Only
filtered_data <- analysis_data %>%
  mutate(
    Death_Rate = Deaths / (Cases + 1e-6), # Calculate death rate (avoid division by zero)
    High_Risk = ifelse(Death_Rate > median(Death_Rate, na.rm = TRUE), 1, 0) # Classify high-risk regions
  )

# Step 2: Logistic Regression Model
# Fit a logistic regression model
logistic_model <- glm(
  High_Risk ~ Sex + Region + Age + Cases,
  family = binomial(),
  data = filtered_data
)

# Summary of the model
summary(logistic_model)

# Step 3: Add Predictions to the Dataset
filtered_data <- filtered_data %>%
  mutate(Predicted_Probability = predict(logistic_model, type = "response"))

# Visualization with Density Plots
ggplot(filtered_data, aes(x = Predicted_Probability, fill = Region)) +
  geom_density(alpha = 0.6) + # Density plot for predicted probabilities
  facet_wrap(~Region, scales = "free") + # Separate density plots by region
  labs(
    title = "",
    x = "Predicted Probability of High Risk",
    y = "Density"
  ) +
  scale_fill_manual(
    values = c("Urban" = "lightgreen", "Rural" = "yellow") 
  ) +
  theme_minimal()

```

@fig-model_region models the predicted probability of high risk for different regions, urban or rural. This is represented by a faceted density plot.

Based on these results, the predicted probability of high risk is higher in rural areas than urban areas and the predicted probability of low risk is higher in urban areas than rural. This is indicated by the height of the peaks at the higher and lower end of the scale, where the peaks for urban regions are taller at the lower end of the probability of high risk scale and shorter at the higher end. The height of the peaks indicate the density of datapoints that fall around the respective predicted value. 

\newpage
## Predicted Probability of High Risk by Sex {#sec-results_sex}

```{r}
#| label: fig-model_sex
#| fig-cap: Predicted probability of high risk based on sex. The box-and-whiskers plots show that the median value of the predicted probability of high risk is similar for males and females. There is a large IQR for both. 
#| echo: false
#| warning: false
#| message: false
#| results: 'hide'

# Load necessary libraries
library(dplyr)
library(ggplot2)
set.seed(21)

# Step 1: Filter for only 'f' and 'm', and define High Risk
filtered_data <- analysis_data %>%
  mutate(
    Death_Rate = Deaths / (Cases + 1e-6), # Calculate death rate (avoid division by zero)
    High_Risk = ifelse(Death_Rate > median(Death_Rate, na.rm = TRUE), 1, 0) # Classify high-risk regions
  )

# Step 2: Logistic Regression Model
# Fit a logistic regression model
logistic_model <- glm(
  High_Risk ~ Sex + Sex + Age + Cases,
  family = binomial(),
  data = filtered_data
)

# Summary of the model
summary(logistic_model)

# Step 3: Add Predictions to the Dataset
filtered_data <- filtered_data %>%
  mutate(Predicted_Probability = predict(logistic_model, type = "response"))

# Step 4: Visualize the Results
# Plot predicted probabilities by sex
ggplot(filtered_data, aes(x = Sex, y = Predicted_Probability, fill = Sex)) +
  geom_boxplot(alpha = 0.6) +
  labs(
    title = "",
    x = "Sex",
    y = "Predicted Probability of High Risk"
  ) +
  scale_fill_manual(
    values = c("m" = "steelblue", "f" = "pink") # Specify colors for "m" and "f"
  ) +
  theme_minimal()

```

@fig-model_sex compares the predicted probability of high risk based on biological sex, representing the model in a similar box-and-whiskers plot method. As shown in the figure, males (represented by 'm') have a noticeably higher predicted probability of high risk than females (represented by 'f'). The predicted probability of a male qualifying as high risk for COVID-19 is above 50%, while the number is below 50% for females. 

## Predicted Probability of High Risk by Age Interval {#sec-results_age}

```{r}
#| label: fig-model_age
#| fig-cap: Predicted probability of high risk based on age intervals. The median predicted probability of high risk is shown as a decimal, where age intervals 20-30 and 50-60 have relatively higher predicted probabilities of high risk. 
#| echo: false
#| warning: false
#| message: false
#| results: 'hide'

# Load necessary libraries
library(dplyr)
library(ggplot2)
set.seed(21)

# Step 1: Create Age Intervals and Define High Risk
filtered_data <- analysis_data %>%
  mutate(
    Age_Interval = cut(Age, breaks = seq(0, 100, by = 10), right = FALSE, include.lowest = TRUE), # Create age intervals
    Death_Rate = Deaths / (Cases + 1e-6), # Calculate death rate (avoid division by zero)
    High_Risk = ifelse(Death_Rate > median(Death_Rate, na.rm = TRUE), 1, 0) # Classify high-risk regions
  ) %>%
  filter(!is.na(Age_Interval)) # Remove any rows with missing age intervals

# Step 2: Logistic Regression Model
# Fit a logistic regression model
logistic_model <- glm(
  High_Risk ~ Sex + Region + Age_Interval + Cases,
  family = binomial(),
  data = filtered_data
)

# Summary of the model
summary(logistic_model)

# Step 3: Add Predictions to the Dataset
filtered_data <- filtered_data %>%
  mutate(Predicted_Probability = predict(logistic_model, type = "response"))

# Compute Median Predicted Probabilities
median_data <- filtered_data %>%
  group_by(Age_Interval) %>%
  summarise(Median_Probability = median(Predicted_Probability, na.rm = TRUE))

# Visualization with Median Bar Plot (Single Color and No Legend)
ggplot(median_data, aes(x = Age_Interval, y = Median_Probability)) +
  geom_bar(stat = "identity", fill = "steelblue", alpha = 0.8) + # All bars have the same color
  geom_text(aes(label = round(Median_Probability, 2)), vjust = -0.5) + # Add value labels
  labs(
    title = "",
    x = "Age Interval",
    y = "Median Predicted Probability of High Risk"
  ) +
  ylim(0, 0.65) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1), # Rotate x-axis labels for readability
    legend.position = "none" # Remove the legend
  )

```

@fig-model_age shows the predicted probability of high risk for different age groups. The age groups are intervals of 10 from 0 to 100 as classified by the original dataset. As shown in the figure, age intervals 10 to 20 and 30 to 40 have a significantly higher predicted probability of high risk than other age groups. This means that it is more likely (around 55% and 57% chance) that someone within these age ranges will qualify as a high risk than the other age groups. The age group with the lowest predicted probability of high risk is 0 to 10 year-olds, yielding a 38% chance median of being predicted as high risk. 


# Discussion {#sec-discussion}

## Interpreting Results {#sec-firstpoint}

The results of this analysis displays information into how demographic and regional factors influence the likelihood of being classified as high risk for COVID-19. The logistic regression model, designed to predict the probability of high risk, effectively highlighted the relative importance of age, sex, and region in shaping these probabilities. 

### Predicted Probability of High Risk by Region {#sec-discussion_region}

Based on @fig-model_region, there is a higher density of individuals predicted to have high risk in the urban regions than in the rural regions. This disparity underscores the potential challenges faced by urban regions, such as overcrowding and not enough healthcare, which may contribute to higher case fatality rates (CFR). Since patients of COVID-19 were encouraged to stay at home even after testing positive at a hospital, patients who lived in urban regions may not have been able to access quick enough healthcare if their symptoms were to worsen quickly. This could be reflected in the higher predicted risks for these communities. Overall, the predicted probability of high risk between the two regions were not much different, potentially reflecting that both regions experience certain challenges in healthcare and are similar in the amount and timeliness of healthcare received. 

Another aspect of the figures that is worth pointing out, if not a more important aspect, is the overall shape. There are significantly higher densities at the extremes of the predicted probability of high risk than moderate levels for both urban and rural regions. A potential explanation of this is that individuals have high disparities in access to healthcare regardless of the region they live in. In other words, people either had really good, timely healthcare or really bad healthcare in both urban and rural regions. This indicates that the region an individual lived in may not have been the strongest predictor the high risk. More research and analysis are needed to identify the underlying variables that correlate with this pattern. 

### Predicted Probability of High Risk by Sex {#sec-discussion_sex}

The analysis showed no significant differences in predicted probability of high risk in males and females. The size of the difference is extremely small, especially compared to the IQR highlighted in @fig-model_sex. The potential differences can be attributed to biological differences, comorbidities, and health-seeking behaviors. There may be a slight difference between sexes in the sensitivity to one's own health conditions, willingness to seek healthcare, and other aspects. However, the analysis shows that the high risk is essentially equal for the two sexes. There is also an extremely large distribution of predicted probabilities within sexes as shown by the IQR. Therefore, more research and analysis will be needed to conclude that there are or are no sexual differences in the predicted probability of high risk. 

### Predicted Probability of High Risk by Age {#sec-discussion_age}

Age also played a pivotal role, with certain age intervals, such as 20-30 and 50-60, showing significantly higher probabilities of high risk. There is no clear trend where higher or lower age groups have increased or decreased predicted risk. This pattern may reflect complex interactions between behavioral, immunological, and societal factors influencing COVID-19 outcomes. For example, 20-30 year-olds may be more engaged in social activities and more constantly in the workplace. They may also be less likely to have started families with children and be less careful with their health and hygiene. 50-60 year-olds may still be out in the work field with relatively high social interactions while also have reduced or decreasing immunity to pathogens. Understanding these relationships is important for tailoring public health interventions and resource allocation strategies. Further research with more targeted variables and measures such as frequency of social activity and overall health conditions may be necessary to find key relationships between age and probability of high risk. 

## Interpreting Predicted Probability of High Risk for COVID-19 {#sec-highrisk}

Based on the model set-up [@sec-model_setup], the probability of high risk is the predicted probability that the calculated level of high risk based on demographic information of a specific datapoint is above the median level of high risk for the dataset. In terms of the real-world, this is the chance that someone is more likely to die from COVID-19 compared to the rest of the population. 

## High Risk Mechanisms in Public Health Research {#sec-publichealth}

The analysis of high risk is commonly used in public health settings, especially in epidemiology. The high risk approach allows the analysis to better identify the groups that are at higher risk or more likely to yield a negative outcome from the disease [@platt]. In the case of this analysis, the high risk groups that are identified are those who are more likely to find COVID-19 fatal rather than mild. 

The results generally show moderate to weak correlations and relationships between the different demographic characteristics and the predicted probability of high risk. This is common depending on the topic of focus. Since COVID-19 is being examined, this situation is considered normal since COVID-19 does not have obvious strong predictors [@marin]. 

Returning to the discussion of the use of the high risk approach in public health research, it is an increasingly popular approach due to the strong focus it has on individuals and communities that are more at risk [@platt]. This can direct actions and prevention to those who are most in need and can be especially important when the disease is fatal, such as COVID-19. Although this analysis shows little difference between different demographic characteristics, the approach can still have an effect when large populations are considered. As for other cases where there are clear differences in risk, for example, using age as a predictor of cancer and implementing closer monitoring for older individuals, may lead to more lives saved [@bastian]. 

## Key Future Implications {#sec-secondpoint}

A key takeaway from this study is the intersection between demographic factors and social determinants of health. There are specific demographic groups that may have well-documented disadvantages in accessing healthcare, which may be reflected as higher risk. Addressing these social determinants, such as income inequality, education, and healthcare infrastructure, could have long-term benefits for public health beyond the current pandemic. Interventions should not only focus on immediate health needs but also work toward alleviating these systemic disparities.

By identifying demographic and regional factors associated with higher probabilities of high risk, policymakers can develop targeted interventions to mitigate disparities. For example, enhancing healthcare infrastructure in rural areas and prioritizing vaccination and testing campaigns for high-risk groups can help reduce the impact of future pandemics.

Additionally, the use of logistic regression models to predict high-risk classifications provides a robust framework for decision-making. This approach could be extended to other diseases or health outcomes, offering a scalable and interpretable method for public health planning. The analysis also highlights the importance of maintaining high-quality, standardized datasets to facilitate cross-regional and cross-demographic comparisons.

## Limitations {#sec-thirdpoint}

Despite its strengths, this study has several limitations that should be addressed in future research. First, the analysis is limited to Canada, which may restrict the generalizability of the findings to other countries with different healthcare systems, cultural contexts, or pandemic responses. Second, the dataset used for this analysis only includes data from 2022, which may not capture temporal variations in COVID-19 patterns. Future studies could incorporate longitudinal data to examine how the predictors of high risk evolve over time.

Another limitation is the reliance on aggregate data, which may obscure individual-level variability and interactions. For example, the interplay between age, sex, and comorbidities at the individual level could yield more relevant information. Additionally, the classification of rural and urban regions may oversimplify the diversity within these categories, such as the distinction between suburban and remote rural areas.

The patterns identified do not show strong correlations. The relationships between the key predictors (age, sex, and region) may not fully capture the complexity of the underlying risk factors. There could be additional variables that influence risk but were not included in this analysis. Furthermore, the correlations between these predictors and the high-risk classification may be influenced by other unmeasured or unobserved factors. These aspects of the dataset require further research to better understand the full range of factors that contribute to COVID-19 risk and to refine the models used for risk classification.

Finally, the data obtained for COVID-19 is obviously in the past and no longer an issue that is of primary concern. This issue is in line with the generalizability issue due to limited surveying countries. The patterns and models may be limited in generalizability due to the sole focus on COVID-19. The data itself also has limitations of not fully representing the population due to data collection methods. Only groups of individuals who report to hospitals or governments were sampled, leading to potential biases. 

## Next Steps {#sec-fourthpoint}

Building on the findings of this study, future research should explore several directions. First, expanding the analysis to include additional countries or regions would provide a better understanding of the factors influencing COVID-19 outcomes. Second, incorporating additional variables, such as socioeconomic status, vaccination rates, and comorbidities, could enhance the predictive power of the models.

Another next step that could be taken is to use the analysis and modeling on a broader series of pandemics and diseases such as seasonal flues, SARS outbreak in the 2000s, and others that may show similar trends. This will allow a broader generalizability of the demographic patterns and allow the model to better predict probability of high risk based on demographic data. Finally, public health practitioners and researchers should collaborate to ensure that findings are translated into actionable policies and interventions.

\newpage

\appendix

# Appendix {#sec-appendix}

## Appendix A: Raw Data {#sec-appendixraw}

```{r}
#| label: fig-head_analysis_data
#| fig-cap: First six rows of the dataset after cleaning. Shows columns including key variables including region, date, sex, age, cases, deaths, and CFR.
#| echo: false
#| warning: false
#| message: false

# Load the necessary library
library(knitr)

# Display the first few rows of analysis_data
head_table <- head(analysis_data)

# Render the table with kable
kable(
  head_table,
  booktabs = TRUE,  # Add better table styling
)
```

## Appendix B: Survey and Sampling Details {#sec-appendixa}

The dataset used in this analysis is sourced from the COVerAGE-DB, a repository of COVID-19 demographic data. The database compiles data from a diverse set of sources, including government health agencies, international organizations, and other reputable institutions, ensuring a broad representation of regions and demographics. Each entry in the dataset represents an aggregation of cases, deaths, and demographic information categorized by age, sex, and region.

### Collection Process

Data collection follows a systematic approach. For primary sources, COVerAGE-DB retrieves data directly from official government dashboards, public health reports, and institutional publications [@dowd2020]. This ensures that the dataset reflects real-world phenomena with minimal distortion.

The database ensures standardization by processing the raw data from various sources through rigorous standardization to ensure comparability. For example, age intervals are harmonized across sources to create a unified structure suitable for cross-regional analysis.

The database also ensures quality Control through running automated checks and manual reviews to detect inconsistencies, missing values, and potential errors in data entry. Such measures are key given the heterogeneity in reporting standards across countries and regions.

Lastly, the update frequency is ensured so the data is as relevant and recent as possible. The database is updated regularly to reflect new data releases, ensuring timeliness and relevance for ongoing research.

### Sampling and Representativeness

While the dataset covers a broad range of countries and regions, its representativeness depends on the completeness and accuracy of the underlying sources. For instance, regions with underdeveloped health reporting infrastructure might have lower data quality or incomplete records. Additionally, variations in testing capacity and reporting standards can introduce biases, particularly in the calculation of derived measures such as case fatality rates (CFR).

### Observational Nature and Limitations

The data is observational, collected without experimental controls. As a result, confounding factors such as healthcare system differences, socioeconomic disparities, and public health policies must be carefully considered when interpreting results [@ioannidis2021]. For instance, differences in testing rates across regions can influence the apparent number of cases and consequently impact measures like CFR.

## Appendix C: Idealized Methodology {#sec-appendix_method}

The data collection method currently used in the dataset has some key limitations of not being able to reach the entire population. The idealized methodology will address these issues by implementing a new way of data collection where, if done in 2022, will provide a more representative dataset of COVID-19 data and information. 

The idealized methodology would have in-person PCR testing for the sample to gather data on the number of tests, number of cases, age, sex, and region. The number of deaths can be difficult to survey in-person without the support of government agencies. Therefore, the data for number of deaths can still be collected from relevant government institutions, as Canadians are required to report deaths to the government. This combined methodology will allow a more accurate dataset of COVID-19 and demographics information. 

### Population

The population, given that the goal of the analysis is to generalize to the Canadian population, would be people living in Canada permanently. This includes all Canadian citizens, permanent residence, and any individuals with a Visa that extends for more than one year (2022). 

### Frame

In the case of this methodology, when there are no financial limitations in play, the frame would be the same as the population. Since there are no restrictions on what households or Canadian citizens can't be sampled, the frame is essentially a subset of the population that is the entire population.

### Sample and Sampling Method

The sample would be a subset from the population. The idealized method must ensure that the sample consists of a representative group of individuals. The method to be used will be systematic sampling, where people would be hired to visit 1 of every 10 houses or apartments (or other units of living) and sample everyone within that household. This will avoid any sampling biases such as only sampling people who go out (if sampled on the streets) or only sampling people who drive (if sampling on roads). 

For every household sampled, the surveyor will conduct a PCR test for each person in the household, record each test, record the number of tests that return as positive as the number of cases, and gather demographic information of each person in the household such as such as sex and age. Region of the household should already be known and should also be recorded as part of the dataset. 

This should result in a dataset with a sufficient sample size. Given that there is an estimated 15.3 million households in 2022 [@households], the sample will consist of 1,530,000 households. There are an estimated 3 people per household [@familysize], leaving a sample of around 4.59 million people. 

The systematic sampling method ensures that a sufficient sample size will be gathered and allows rather accurate prediction of the number of datapoints within the sample. It also ensures for uniform coverage and that sampling wouldn't be biased towards certain communities or subgroups. However, limitations could surface if the selected samples are not responding, not available, or refuse to co-operate. The systematic sampling method makes it hard to change the sample size if sitations like this were to occur. 

The sampling procedure will be repeated monthly until the end of the year to gather time-related data. 

### Handling Non-response

Non-response could mean not being at home during the visit of the surveyor or not willing to participate. The initial response to this could be to re-visit another time and attempt to persuade the participant to co-operate. 

If a small number of households refuse to participate after repeated visits, the broad demographic information (such as region) can be recorded and later adjusted for during the data anlysis process. However, if a large number of households refuse to participate, specific parts of the data may need to be re-sampled or dropped, which may cause biases in the analysis. An attempt to address this may be to adjust the dataset based on known demographic information, but certain biases may be unavoidable. 

### Idealized Procedure

**Consent:** The surveyor will read this to the participant of the test before conducting the tests and ask for their signature. 

"Thank you for your will in potentially co-operating in this COVID-19 study. By participating in this study, you agree to provide demographic information and respond to questions related to COVID-19. The procedure will require conducting PCR test for you and asking you basic questions regarding your demographic characteristics. Your participation is voluntary, and all data will be kept confidential and anonymous and used solely for research purposes. You may withdraw from the study at any time without penalty. If you have any questions about the study, please feel free to ask. If you acknowledge your rights and are willing to consent to this study, please sign."

**PCR:** The surveyor will conduct a PCR test for individuals who have consented to the study. 

**COVID-19 Information:** The surveyor will record the number of PCR tests conducted in the household and the number of positives. 

**Demographic Questions:** The surveyor will ask the following questions or record the known answer. \begin{itemize}
  \item What is your biological sex at birth?
  \item What is your age?
  \item What area do you live in? Urban or rural?
\end{itemize}


**Debrief:** The surveyor will read the following to the participants after conducting the test and asking the questions. 

"Thank you for participating in this study. The information you provided on demographic factors and the test done for COVID-19 positivity will help us better understand the impact of the pandemic across different demographic groups. Your responses will contribute to research aimed at improving public health strategies. If you have any questions or would like further information about the study, please feel free to contact us at "brucejc.zhang\@mail.utoronto.ca"

**Data Consolidation:** The data collected by surveyors will be matched with the death-data from governments and hospitals at the end of the year of 2022 and will prepare the data for analysis for any patterns or trends as done in this analysis. 

## Appendix D: Model Selection Details {#sec-appendixb}

During the model selection process, model figures were generated for the linear regression model. As shown in @fig-appendixb, the data was difficult to represent and relationships were difficult to identify due to the categorical nature of the variables. This led to attempts to model the data in different ways. The second method that was attempted was using a logistic regression model, which was able to represent the data well and make predictions about high risk. These figures are shown within the @sec-results of the paper. 

```{r}
#| label: fig-appendixb
#| fig-cap: Linear Regression Model for dataset. No clear pattern can be observed. Weak predictive power is seen. 
#| echo: false
#| warning: false
#| message: false
#| results: 'hide'

# Load necessary libraries
library(dplyr)
library(ggplot2)
set.seed(21)

# Prepare the data by calculating CFR and filtering for valid rows
filtered_data <- analysis_data %>%
  mutate(CFR = (Deaths / Cases) * 100) %>% # Calculate CFR (%)
  filter(!is.na(CFR)) # Remove rows with missing CFR

# Fit a linear regression model
linear_model <- lm(CFR ~ Age + Sex + Region, data = filtered_data)

# Summary of the linear regression model
summary(linear_model)

# Visualize the model predictions vs actual CFR
filtered_data <- filtered_data %>%
  mutate(Predicted_CFR = predict(linear_model, newdata = filtered_data))

ggplot(filtered_data, aes(x = Predicted_CFR, y = CFR)) +
  geom_point(alpha = 0.5) +
  geom_abline(intercept = 0, slope = 1, color = "red", linetype = "dashed") +
  labs(
    title = "Predicted vs Actual CFR (Linear Regression)",
    x = "Predicted CFR",
    y = "Actual CFR"
  ) +
  theme_minimal()

```

## Appendix E: Model Validation Details {#sec-appendixc}

### ROC Curve and AUC

```{r}
#| label: fig-appendix_roc
#| fig-cap: ROC Curve and AUC Value for Logistic Regression Model. The ROC curve and AUC values show that the logistic regression model yields a moderately high predictive performance for the dataset. 
#| echo: false
#| warning: false
#| message: false

# Load necessary libraries
library(pROC)
library(ggplot2)
library(here)
library(arrow)
set.seed(21)

analysis_data <- read_parquet(here("data", "03-model_data", "modeling_data.parquet"))

# Ensure High_Risk is binary (convert if necessary)
analysis_data <- analysis_data %>%
  mutate(High_Risk = as.numeric(as.character(High_Risk)))

# Generate the ROC curve
roc_curve <- roc(
  response = analysis_data$High_Risk,  # True labels
  predictor = analysis_data$Predicted_Probability  # Predicted probabilities
)

# Calculate AUC
auc_value <- auc(roc_curve)

# Plot the ROC curve
roc_plot <- ggplot() +
  geom_line(data = data.frame(
    specificity = rev(roc_curve$specificities),
    sensitivity = rev(roc_curve$sensitivities)
  ), aes(x = specificity, y = sensitivity), color = "blue", size = 1) +
  labs(
    title = "ROC Curve",
    x = "Specificity",
    y = "Sensitivity"
  ) +
  theme_minimal()

# Display the AUC value
cat("AUC:", auc_value, "\n")

# Generate the ROC curve
roc_curve <- roc(analysis_data$High_Risk, analysis_data$Predicted_Probability)
auc_value <- auc(roc_curve)

# Plot the ROC curve
roc_plot <- ggplot() +
  geom_line(
    data = data.frame(
      specificity = rev(roc_curve$specificities),
      sensitivity = rev(roc_curve$sensitivities)
    ),
    aes(x = specificity, y = sensitivity),
    color = "black", size = 1.2
  ) +
  geom_abline(linetype = "dashed", color = "red") + # Add the diagonal line
  labs(
    title = "",
    x = "1 - Specificity",
    y = "Sensitivity"
  ) +
  annotate("text", x = 0.7, y = 0.2, label = paste0("AUC = ", round(auc_value, 3)), size = 5, color = "black") +
  theme_minimal() +
  theme(
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold")
  )

# Print the plot in your script to display in the rendered document
roc_plot

```


### Confusion Matrix

```{r}
#| label: fig-appendix_confusion
#| fig-cap: Confusion Matrix for Logistic Regression Model
#| echo: false
#| warning: false
#| message: false

# Load necessary library
library(caret)
set.seed(21)

# Step 1: Create Predicted Classes
# Add a column with predicted classes based on a 0.5 threshold
analysis_data <- analysis_data %>%
  mutate(
    Predicted_Class = ifelse(Predicted_Probability >= 0.5, 1, 0) # Classify as High Risk (1) if probability >= 0.5
  )

# Step 2: Generate Confusion Matrix
# Convert classes to factors for compatibility
actual_classes <- factor(analysis_data$High_Risk, levels = c(0, 1))
predicted_classes <- factor(analysis_data$Predicted_Class, levels = c(0, 1))

# Create confusion matrix
conf_matrix <- confusionMatrix(predicted_classes, actual_classes)

# Step 3: Print Confusion Matrix
print(conf_matrix)

```
\newpage
### Odds Ratio with Confidence Intervals

```{r}
#| label: fig-odds_ratio
#| fig-cap: Odds Ratio table with Confidence Intervals
#| echo: false
#| warning: false
#| message: false

# Load necessary libraries
library(broom)
library(knitr)
library(dplyr)
set.seed(21)

# Step 1: Compute Odds Ratios and Confidence Intervals
# Use `tidy()` to extract model coefficients and calculate odds ratios
odds_ratios <- tidy(logistic_model, conf.int = TRUE, exponentiate = TRUE)

# Step 2: Format the Table for Better Display
# Rename columns for better readability
odds_ratios <- odds_ratios %>%
  rename(
    Predictor = term,
    Odds_Ratio = estimate,
    Lower_95CI = conf.low,
    Upper_95CI = conf.high
  )

# Step 3: Display the Table using kable
kable(
  odds_ratios,
  col.names = c("Predictor", "Odds Ratio", "Standard Error", "Statistic", "P Value", "Lower 95% CI", "Upper G5% CI"), 
  booktabs = TRUE,
  digits = 3
)
```



\newpage

# References
